<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WeIrDcAsEr</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,
    <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
      <text y='.9em' font-size='90'>ðŸ˜ˆ</text>
    </svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500;700&family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap"
    rel="stylesheet">

  <style>
    body {
      background-color: #212121;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      overflow: hidden;
    }

    #run {
      font-size: 14vmin;
      font-family: jetbrains mono, monospace;
      font-weight: 700;
      color: #212121;
      height: 30vmin;
      width: 30vmin;
      border: 0px;
      border-radius: 100%;
      background-color: #303030;
      cursor: pointer;
      background-image: linear-gradient(to right, #911a80, #d42b45);
      /* box-shadow: 0 0 10px rgba(0, 0, 0, 0.3); */
      opacity: 0.5;
      transition: opacity 0.2s, font-size 0.2s;

      position: fixed;
      left: 0;
      top: 0;
      will-change: transform;
      user-select: none;
    }

    #run:hover {
      opacity: 1;
      font-size: 30px;
    }

    #run.is-hover {
      opacity: 0.75;
    }


    #stop {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      font-family: jetbrains mono, monospace;
      font-size: 14px;
      color: #bdbdbd;
      background: none;
      border: none;
      cursor: pointer;
      z-index: 0;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    #stop:hover {
      opacity: 1;
      color: white;
    }
  </style>
</head>

<body>
  <button id="run">Run</button>
  <button id="stop">stop</button>

  <script>
    const button = document.getElementById('run');
    const stopButton = document.getElementById('stop');
    let isStopped = false;
    let stopTimerStarted = false;

    let impactHoverTimer = null;

    function triggerImpactHover(ms = 180) {
      button.classList.add('is-hover');
      clearTimeout(impactHoverTimer);
      impactHoverTimer = setTimeout(() => {
        button.classList.remove('is-hover');
      }, ms);
    }

    // "Flee" physics
    const cfg = {
      fleeRadius: 220,     // px: when cursor gets closer than this, button runs away
      accel: 6,          // acceleration multiplier
      friction: 1,      // 0..1: lower = more damping
      maxSpeed: 14,        // px per frame
      bounce: 0.7        // 0..1: energy kept on wall bounce
    };

    let mouseX = window.innerWidth / 2;
    let mouseY = window.innerHeight / 2;

    // Button position in px (top-left corner)
    let posX = 0;
    let posY = 0;
    let velX = 0;
    let velY = 0;

    function clamp(v, min, max) {
      return Math.max(min, Math.min(max, v));
    }

    function resetToCenter() {
      const rect = button.getBoundingClientRect();
      posX = (window.innerWidth - rect.width) / 2;
      posY = (window.innerHeight - rect.height) / 2;
      velX = 0;
      velY = 0;
      button.style.transform = `translate3d(${posX}px, ${posY}px, 0)`;
    }

    resetToCenter();

    document.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
    });

    function tick() {
      if (isStopped) {
        button.style.transform = `translate3d(${posX}px, ${posY}px, 0)`;
        requestAnimationFrame(tick);
        return;
      }
      const rect = button.getBoundingClientRect();
      const centerX = posX + rect.width / 2;
      const centerY = posY + rect.height / 2;

      const dx = mouseX - centerX;
      const dy = mouseY - centerY;
      const dist = Math.hypot(dx, dy);

      if (dist > 0 && dist < cfg.fleeRadius) {
        if (!stopTimerStarted) {
          stopTimerStarted = true;
          setTimeout(() => {
            stopButton.style.opacity = '0.6';
            stopButton.style.pointerEvents = 'auto';
          }, 1000);
        }
        // Run away from the cursor, stronger when closer
        const t = 1 - dist / cfg.fleeRadius; // 0..1
        const nx = dx / dist;
        const ny = dy / dist;

        velX += (-nx) * cfg.accel * (t * t) * 18;
        velY += (-ny) * cfg.accel * (t * t) * 18;
      }

      // Clamp speed
      velX = clamp(velX, -cfg.maxSpeed, cfg.maxSpeed);
      velY = clamp(velY, -cfg.maxSpeed, cfg.maxSpeed);

      // Integrate
      posX += velX;
      posY += velY;

      // Walls (viewport bounce)
      const maxX = window.innerWidth - rect.width;
      const maxY = window.innerHeight - rect.height;

      let bounced = false;

      if (posX < 0) {
        posX = 0;
        velX = -velX * cfg.bounce;
        bounced = true;
      } else if (posX > maxX) {
        posX = maxX;
        velX = -velX * cfg.bounce;
        bounced = true;
      }

      if (posY < 0) {
        posY = 0;
        velY = -velY * cfg.bounce;
        bounced = true;
      } else if (posY > maxY) {
        posY = maxY;
        velY = -velY * cfg.bounce;
        bounced = true;
      }

      if (bounced) triggerImpactHover();

      // Friction (damping)
      velX *= cfg.friction;
      velY *= cfg.friction;

      button.style.transform = `translate3d(${posX}px, ${posY}px, 0)`;
      requestAnimationFrame(tick);
    }

    requestAnimationFrame(tick);

    window.addEventListener('resize', resetToCenter);

    stopButton.addEventListener('click', () => {
      isStopped = true;
      velX = 0;
      velY = 0;

      // Hide "stop" after use
      stopButton.style.opacity = '0';
      stopButton.style.pointerEvents = 'none';
    });

    button.addEventListener('click', () => {
      let str = prompt('enter text');
      if (str === null) return;

      let newStr = '';
      let letterIndex = 0;

      for (let i = 0; i < str.length; i++) {
        if (str[i] === ' ') {
          newStr += ' ';
        } else {
          newStr += letterIndex % 2 === 0
            ? str[i].toUpperCase()
            : str[i].toLowerCase();
          letterIndex++;
        }
      }

      alert(newStr);
    });
  </script>
</body>

</html>